<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>GallereasyGiphySearch</title>

    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.3/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
    <link rel="stylesheet" type="text/css" href="main.css">
</head>

<body>
    <h1 class="text-center">GallereasyGiphySearch</h1>

    <!-- Search form -->
    <div class="row active-search">
        <div class="col-xs-offset-4 col-xs-4">
            <input class="form-control" type="text" placeholder="Start searching for images!" aria-label="Search" id="search_Giphy">
        </div>
    </div>

    <div id="gallery">
    </div>
    <div id="gallery_moreImages">
    </div>

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Bootstrap JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script>
        //javascript, jQuery

        // Setup Global Variables
        var searchCounter = 0;
        var searchLimit = 8;
        var searchResult = "";
        var searchGiphy = "http://api.giphy.com/v1/gifs/search?q=ryan+gosling&api_key=YOUR_API_KEY&limit=5";
        var newSearchState = true;
        var fetchMoreButton = true;

        $('#search_Giphy').on('keydown', function (e) {
            // only trigger search when user press down enter
            if (e.which == '13') {
                searchResult = $('#search_Giphy').val();
                console.log(searchGiphy, "searchGiphy url");
                search_Giphy_results();
                // console.log(searchResult, "what is search result");
                // console.log("enter has been pressed");
            }
        });

        function search_Giphy_results() {

            if (newSearchState) {
                $("#gallery").empty();
                searchCounter = 0;
                searchLimit = 8;
            } else {
                searchLimit = searchLimit + 8;
            }

            searchGiphy = "http://api.giphy.com/v1/gifs/search?q=" + searchResult +
                "&api_key=EL0x22eZIsaBOefGty0lhD4CLRXzPWjA&limit=" + searchLimit;

            var jqxhr = $.get(searchGiphy, function (data) {
                    console.log("success");
                })
                .done(function (data) {
                    // console.log("second success");
                    // console.log("success got data", data);

                    // console.log(searchCounter, "search counter");
                    // console.log(searchLimit, "search Limit");
                    // console.log(data, "data");

                    // need to do a for loop and append the data
                    for (searchCounter; searchCounter < searchLimit; searchCounter++) {
                        console.log(searchCounter, "searchCounter value inside the for loop");
                        console.log(searchLimit, "searchLimit value inside the for loop");

                        if (typeof data.data[searchCounter] == 'undefined') {
                            if (searchCounter === 0) {
                                $("#gallery").append("No Results");
                            } else {
                                $("#gallery").append("No More Results");
                            }
                            console.log("no more results");

                            break;
                        }

                        $("#gallery").append("<iframe id=" + searchCounter + " class=\"gallery_images\" src=" +
                            data.data[searchCounter].embed_url +
                            ">" + "</iframe>");

                        console.log(data.data[searchCounter].embed_url, "what is data i embed url");
                    }

                    // append fetch more button
                    if (newSearchState && fetchMoreButton) {
                        console.log(fetchMoreButton, "fetch more button");
                        var r = $('<input/>').attr({
                            type: "button",
                            id: "field",
                            value: "Fetch More",
                            onclick: "fetchMoreImages()"
                        });
                        $("#gallery_moreImages").append(r);
                        fetchMoreButton = false;
                    }
                    newSearchState = true;
                })
                .fail(function () {
                    console.log("error");
                })
                .always(function () {
                    console.log("finished");
                });
            // Perform other work here ...

            // Set another completion function for the request above
            jqxhr.always(function () {
                console.log("second finished");
            });
        }

        function fetchMoreImages() {
            newSearchState = false;
            search_Giphy_results();
        }
    </script>
</body>

</html>